-- Custom tables for tracking batch job executions beyond Spring Batch's standard tables
-- This schema complements the standard Spring Batch tables with additional tracking capability

-- Custom job execution table with extended fields
CREATE TABLE IF NOT EXISTS CUSTOM_JOB_EXECUTION (
    JOB_EXECUTION_ID BIGINT PRIMARY KEY,
    JOB_INSTANCE_ID BIGINT NOT NULL,
    JOB_NAME VARCHAR(100) NOT NULL,
    START_TIME TIMESTAMP,
    END_TIME TIMESTAMP,
    STATUS VARCHAR(10),
    EXIT_CODE VARCHAR(20),
    EXIT_MESSAGE VARCHAR(2500),
    LAST_UPDATED TIMESTAMP,
    CREATE_TIME TIMESTAMP
);

-- Custom job parameters table for easier querying
CREATE TABLE IF NOT EXISTS CUSTOM_JOB_PARAMS (
    JOB_PARAM_ID BIGINT IDENTITY PRIMARY KEY,
    JOB_EXECUTION_ID BIGINT NOT NULL,
    PARAM_KEY VARCHAR(100) NOT NULL,
    PARAM_VALUE VARCHAR(2500),
    PARAM_TYPE VARCHAR(100) NOT NULL,
    CONSTRAINT FK_JOB_PARAMS_EXECUTION FOREIGN KEY (JOB_EXECUTION_ID)
    REFERENCES CUSTOM_JOB_EXECUTION (JOB_EXECUTION_ID)
);

-- Index for performance optimization
CREATE INDEX IF NOT EXISTS IDX_CUSTOM_JOB_EXECUTION_JOB_NAME ON CUSTOM_JOB_EXECUTION(JOB_NAME);